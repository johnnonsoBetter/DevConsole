<!DOCTYPE html>
<html>
<head>
  <title>DevConsole Diagnostic</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #0f172a;
      color: #e2e8f0;
    }
    .test { margin: 10px 0; padding: 10px; background: #1e293b; border-left: 3px solid #9E7AFF; }
    button { background: #9E7AFF; color: white; border: none; padding: 8px 16px; cursor: pointer; margin: 5px; }
  </style>
</head>
<body>
  <h1>üîç DevConsole Diagnostic</h1>
  
  <div class="test">
    <h3>1. Check Extension Context</h3>
    <button onclick="checkExtension()">Check Extension</button>
    <pre id="extension-result"></pre>
  </div>

  <div class="test">
    <h3>2. Check Page Hook Injection</h3>
    <button onclick="checkPageHook()">Check Page Hook</button>
    <pre id="hook-result"></pre>
  </div>

  <div class="test">
    <h3>3. Test Console Interception</h3>
    <button onclick="testConsole()">Test Console</button>
    <pre id="console-result"></pre>
  </div>

  <div class="test">
    <h3>4. Test Network Interception</h3>
    <button onclick="testNetwork()">Test Network</button>
    <pre id="network-result"></pre>
  </div>

  <div class="test">
    <h3>5. Check Message Relay</h3>
    <button onclick="checkMessages()">Check Messages</button>
    <pre id="message-result"></pre>
  </div>

  <script>
    function checkExtension() {
      const result = document.getElementById('extension-result');
      const checks = [];
      
      checks.push(`chrome object: ${typeof chrome !== 'undefined' ? '‚úÖ' : '‚ùå'}`);
      checks.push(`chrome.runtime: ${typeof chrome?.runtime !== 'undefined' ? '‚úÖ' : '‚ùå'}`);
      checks.push(`chrome.runtime.id: ${chrome?.runtime?.id || '‚ùå Not available'}`);
      
      result.textContent = checks.join('\n');
    }

    function checkPageHook() {
      const result = document.getElementById('hook-result');
      const checks = [];
      
      checks.push(`__devConsoleControl: ${typeof window.__devConsoleControl !== 'undefined' ? '‚úÖ' : '‚ùå'}`);
      checks.push(`__devConsole_restore: ${typeof window.__devConsole_restore !== 'undefined' ? '‚úÖ' : '‚ùå'}`);
      
      if (window.__devConsoleControl) {
        checks.push(`Control API methods:`);
        checks.push(`  - enable: ${typeof window.__devConsoleControl.enable === 'function' ? '‚úÖ' : '‚ùå'}`);
        checks.push(`  - disable: ${typeof window.__devConsoleControl.disable === 'function' ? '‚úÖ' : '‚ùå'}`);
        checks.push(`  - status: ${typeof window.__devConsoleControl.status === 'function' ? '‚úÖ' : '‚ùå'}`);
      }
      
      result.textContent = checks.join('\n');
    }

    function testConsole() {
      const result = document.getElementById('console-result');
      result.textContent = 'Logging test message... Check DevTools console and DevConsole panel';
      
      console.log('üß™ TEST: Simple log message');
      console.warn('üß™ TEST: Warning message');
      console.error('üß™ TEST: Error message');
      console.info('üß™ TEST: Info message');
      
      setTimeout(() => {
        result.textContent += '\n‚úÖ Test messages sent. Check both consoles.';
      }, 100);
    }

    async function testNetwork() {
      const result = document.getElementById('network-result');
      result.textContent = 'Testing network request...';
      
      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
        const data = await response.json();
        result.textContent = `‚úÖ Network request completed\nStatus: ${response.status}\nData: ${JSON.stringify(data, null, 2).substring(0, 200)}...`;
      } catch (error) {
        result.textContent = `‚ùå Network request failed: ${error.message}`;
      }
    }

    let messageCount = 0;
    function checkMessages() {
      const result = document.getElementById('message-result');
      
      // Listen for postMessage
      window.addEventListener('message', (event) => {
        if (event.data && event.data.__devConsole) {
          messageCount++;
          result.textContent = `‚úÖ Intercepted ${messageCount} messages\nLast: ${JSON.stringify(event.data, null, 2).substring(0, 300)}...`;
        }
      });
      
      // Trigger some messages
      console.log('Test message for relay check');
      
      setTimeout(() => {
        if (messageCount === 0) {
          result.textContent = '‚ùå No messages intercepted. Page hook may not be loaded.';
        }
      }, 500);
    }

    // Auto-run checks on load
    window.addEventListener('load', () => {
      console.log('üîç Diagnostic page loaded');
      console.log('üìã Instructions:');
      console.log('1. Open DevTools ‚Üí DevConsole tab');
      console.log('2. Run each diagnostic button');
      console.log('3. Check for errors in both the regular console and DevConsole panel');
    });
  </script>
</body>
</html>
